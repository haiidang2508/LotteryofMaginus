<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>V√© s·ªë Online (Demo)</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>üéüÔ∏è V√© S·ªë Online (Demo)</h1>

  <div class="header-links">
    <a href="database.html" class="link-database">ÔøΩ Xem L·ªãch S·ª≠ Mua V√©</a>
  </div>

  <div class="tickets-container" id="ticketsContainer"></div>

  <!-- Modal Form -->
  <div id="buyModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h2>Mua V√© S·ªë</h2>
      <form id="buyForm" onsubmit="submitBuyForm(event)">
        <div class="form-group">
          <label for="modalTicketNumber">S·ªë V√©:</label>
          <input type="text" id="modalTicketNumber" readonly>
        </div>

        <div class="form-group">
          <label for="modalBuyerName">T√™n Ng∆∞·ªùi Mua: <span class="required">*</span></label>
          <input 
            type="text" 
            id="modalBuyerName" 
            placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n" 
            required
          >
        </div>

        <div class="form-buttons">
          <button type="submit" class="btn-primary">X√°c Nh·∫≠n Mua</button>
          <button type="button" class="btn-secondary" onclick="closeModal()">H·ªßy</button>
        </div>
      </form>
    </div>
  </div>

  <footer>
    *Trang m√¥ ph·ªèng ‚Äì kh√¥ng giao d·ªãch th·∫≠t
  </footer>

  <script>
    let currentTicketNumber = '';
    let currentButton = null;

    // H√†m t·∫°o s·ªë ng·∫´u nhi√™n t·ª´ 001 t·ªõi 100
    function generateRandomNumber() {
      return String(Math.floor(Math.random() * 100) + 1).padStart(3, '0');
    }

    // H√†m t·∫°o 10 v√© s·ªë
    function generateTickets() {
      const container = document.getElementById('ticketsContainer');
      for (let i = 0; i < 10; i++) {
        const ticketNumber = generateRandomNumber();
        const ticketDiv = document.createElement('div');
        ticketDiv.className = 'ticket';
        
        ticketDiv.innerHTML = `
          <p class="number">${ticketNumber}</p>
          <p class="price">Gi√°: 10.000ƒë</p>
          <button type="button" onclick="openBuyModal('${ticketNumber}', this)">Mua v√©</button>
        `;
        
        container.appendChild(ticketDiv);
      }
    }

    // M·ªü modal form
    function openBuyModal(ticketNumber, button) {
      currentTicketNumber = ticketNumber;
      currentButton = button;
      document.getElementById('modalTicketNumber').value = ticketNumber;
      document.getElementById('modalBuyerName').value = '';
      document.getElementById('buyModal').style.display = 'block';
      document.getElementById('modalBuyerName').focus();
    }

    // ƒê√≥ng modal
    function closeModal() {
      document.getElementById('buyModal').style.display = 'none';
      currentTicketNumber = '';
      currentButton = null;
    }

    // Submit form mua v√©
    function submitBuyForm(event) {
      event.preventDefault();
      
      const buyerName = document.getElementById('modalBuyerName').value.trim();
      
      if (buyerName === '') {
        alert('Vui l√≤ng nh·∫≠p t√™n!');
        return;
      }

      // C·∫≠p nh·∫≠t n√∫t
      currentButton.textContent = '‚úì ƒê√£ mua';
      currentButton.disabled = true;
      currentButton.style.background = '#4caf50';
      
      // Hi·ªÉn th·ªã th√¥ng tin ng∆∞·ªùi mua tr√™n v√©
      const ticketDiv = currentButton.closest('.ticket');
      const buyerInfo = document.createElement('p');
      buyerInfo.className = 'buyer-info';
      buyerInfo.textContent = 'Ng∆∞·ªùi mua: ' + buyerName;
      ticketDiv.insertBefore(buyerInfo, currentButton);
      
      // L∆∞u d·ªØ li·ªáu v√†o localStorage
      const buyersData = JSON.parse(localStorage.getItem('buyers')) || [];
      buyersData.push({
        ticketNumber: currentTicketNumber,
        name: buyerName,
        date: new Date().toISOString()
      });
      localStorage.setItem('buyers', JSON.stringify(buyersData));
      
      // ƒê√≥ng modal
      closeModal();
      
      // Hi·ªÉn th·ªã th√¥ng b√°o
      alert(`Mua v√© s·ªë ${currentTicketNumber} th√†nh c√¥ng!\nT√™n: ${buyerName}`);
    }

    // ƒê√≥ng modal khi click b√™n ngo√†i
    window.onclick = function(event) {
      const modal = document.getElementById('buyModal');
      if (event.target == modal) {
        closeModal();
      }
    }

    // G·ªçi h√†m t·∫°o v√© khi trang load
    document.addEventListener('DOMContentLoaded', generateTickets);
  </script>
</body>
</html>
